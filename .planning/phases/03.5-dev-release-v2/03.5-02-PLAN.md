---
phase: 03.5-dev-release-v2
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "tektoncd-pipeline Konflux rebuild completed successfully"
    - "New nop image SHA available in Konflux registry"
    - "Konflux nudge PR created in operator repo OR new SHA manually identified"
  artifacts:
    - path: "Konflux build"
      provides: "pipeline-nop-rhel8 with FIPS fix"
      contains: "new SHA different from 01381d3d77e9eef98b85fbbbae45a0355c0aec5ee86abaa79476e0d20062c4ea"
  key_links:
    - from: "PR #1540 merge"
      to: "Konflux on-push pipeline"
      via: "automatic trigger"
      pattern: "merge commit -> rebuild"
    - from: "Konflux rebuild"
      to: "Nudge PR or Snapshots API"
      via: "Konflux automation"
      pattern: "build complete -> SHA available"
---

<objective>
Monitor FIPS nop.Dockerfile rebuild status and confirm new image SHA is available.

Purpose: Phase 3.4 merged the FIPS fix (PR #1540). Konflux should have triggered a rebuild. We need to confirm the rebuild completed and identify the new SHA before triggering operator-update-images.

Output: Confirmed new nop image SHA, ready for operator-update-images workflow.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.5-dev-release-v2/03.5-RESEARCH.md
@.planning/phases/03.4-cherry-pick-fips/03.4-VERIFICATION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Check Konflux on-push pipeline status for tektoncd-pipeline</name>
  <files></files>
  <action>
    Check if the Konflux on-push pipeline triggered by PR #1540 merge has completed.

    Methods to check:
    1. **GitHub Actions** - Look for Konflux integration actions in tektoncd-pipeline repo
       ```bash
       gh run list --repo openshift-pipelines/tektoncd-pipeline --branch release-v1.15.x --limit 5
       ```

    2. **Konflux Snapshots API** - Query for latest snapshot
       ```bash
       # Get latest snapshot for tektoncd-pipeline 1-15 application
       curl -s "https://console.redhat.com/api/image-builder/v1/composes" \
         -H "Authorization: Bearer $KONFLUX_TOKEN" | jq '.[]'
       ```

    3. **Check operator repo for nudge PRs** - Konflux auto-creates PRs when component images rebuild
       ```bash
       gh pr list --repo openshift-pipelines/operator --search "Konflux nudge" --state all --limit 10
       ```

    4. **Check Konflux registry directly** - See if nop image has new SHA
       ```bash
       skopeo inspect --creds "${QUAY_USER}:${QUAY_TOKEN}" \
         docker://quay.io/redhat-user-workloads/tekton-ecosystem-tenant/1-15/tektoncd-pipeline-nop-rhel8 | jq '.Digest'
       ```

    Record:
    - Pipeline status (running/completed/failed)
    - New nop image SHA (if available)
    - Any Konflux nudge PR numbers
  </action>
  <verify>
    - Pipeline completed (not still running)
    - Can retrieve image SHA from Konflux registry
    - SHA is different from old SHA: `01381d3d77e9eef98b85fbbbae45a0355c0aec5ee86abaa79476e0d20062c4ea`
  </verify>
  <done>
    Konflux on-push pipeline completed, new nop SHA identified and recorded
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Checked Konflux rebuild status for tektoncd-pipeline component after FIPS fix merge</what-built>
  <how-to-verify>
    **If pipeline COMPLETED:**
    1. Confirm new nop SHA is different from old SHA
    2. Verify image is accessible in Konflux registry
    3. Type "confirmed" to proceed to Plan 03.5-03

    **If pipeline STILL RUNNING:**
    1. Wait for completion (check Konflux dashboard)
    2. Type "running - will wait" and come back later

    **If pipeline FAILED:**
    1. Check failure logs
    2. Determine if retry needed
    3. Type "failed - [reason]" for diagnosis
  </how-to-verify>
  <resume-signal>
    Type one of:
    - "confirmed" - Pipeline complete, new SHA available
    - "running" - Pipeline still in progress, pause until complete
    - "failed - [reason]" - Pipeline failed, needs investigation
  </resume-signal>
</task>

</tasks>

<verification>
After both tasks complete:
1. Konflux on-push pipeline for tektoncd-pipeline completed
2. New nop image SHA recorded
3. SHA differs from old value (01381d3d77e9eef98b85fbbbae45a0355c0aec5ee86abaa79476e0d20062c4ea)

Note: We don't need to copy the nop image separately - the operator-update-images workflow in Plan 03.5-03 will handle all image references.
</verification>

<success_criteria>
- [ ] Konflux on-push pipeline completed (not running/failed)
- [ ] New nop image SHA identified
- [ ] SHA is different from pre-FIPS-fix SHA
- [ ] Human confirmed ready to proceed
</success_criteria>

<output>
After completion, create `.planning/phases/03.5-dev-release-v2/03.5-02-SUMMARY.md`

Include:
- Konflux pipeline status and completion time
- Old nop SHA vs new nop SHA
- Any nudge PRs found
- Ready status for Plan 03.5-03
</output>
