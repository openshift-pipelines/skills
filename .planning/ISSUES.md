# Project Issues Log

Enhancements discovered during execution. Not critical - address in future phases.

## Blockers

### ISS-005: Index PR Konflux pipelines failing due to missing service account

- **Discovered:** Phase 3 Plan 1 (2026-01-19) — during dev release execution
- **Status:** BLOCKING Phase 3 execution
- **Severity:** High — prevents index image builds for devel release

**Root Cause:**
The `.tekton/operator-1-15-index-*-pull-request.yaml` files are missing a `serviceAccountName` in their `taskRunTemplate`. The `git-clone-oci-ta` task tries to push OCI artifacts to the registry but fails with "Unauthorized error, wrong registry credentials provided" because there's no service account providing the credentials.

**Comparison:**
| Pipeline | Service Account | Status |
|----------|-----------------|--------|
| `operator-1-15-bundle-on-pull-request` | `build-pipeline-operator-1-15-bundle` | ✅ PASSING |
| `operator-1-15-index-4-*-on-pull-request` | **EMPTY** `{}` | ❌ FAILING |

**Files Affected (in openshift-pipelines/operator repo):**
- `.tekton/operator-1-15-index-4-12-pull-request.yaml`
- `.tekton/operator-1-15-index-4-14-pull-request.yaml`
- `.tekton/operator-1-15-index-4-15-pull-request.yaml`
- `.tekton/operator-1-15-index-4-16-pull-request.yaml`
- `.tekton/operator-1-15-index-4-17-pull-request.yaml`
- `.tekton/operator-1-15-index-4-18-pull-request.yaml`

**Investigation Details:**
1. All 6 index PRs created by `index-render-template` workflow fail immediately (~25s)
2. Failure occurs in `clone-repository` task which uses `git-clone-oci-ta`
3. Task tries to push cloned content as OCI artifact to `quay.io/redhat-user-workloads/tekton-ecosystem-tenant/operator-1-15-index-4-*-application/...`
4. Without service account credentials, the push fails
5. Index components use separate Konflux applications (`operator-1-15-index-4-18-application`) unlike bundle which shares `openshift-pipelines-operator-1-15`

**Open PRs Blocked:**
- #14207: [bot:release-v1.15.x] Update v4.18 generate catalog
- #14208: [bot:release-v1.15.x] Update v4.17 generate catalog
- #14209: [bot:release-v1.15.x] Update v4.15 generate catalog
- #14210: [bot:release-v1.15.x] Update v4.16 generate catalog
- #14211: [bot:release-v1.15.x] Update v4.14 generate catalog
- #14212: [bot:release-v1.15.x] Update v4.12 generate catalog

**Fix Required:**
The `.tekton` files are generated by `openshift-pipelines/hack` repo. Fix options:
1. Update hack repo template to include service account for index pipelines
2. Manually add service account to operator repo .tekton files (temporary)
3. Configure Konflux index applications with proper image repository secrets

**Workaround Options:**
1. Force merge with `/override` if tide allows
2. Disable Konflux check requirement temporarily
3. Fix the underlying configuration issue

- **Priority:** High — blocks Phase 3 dev release completion
- **Owner:** Needs hack repo maintainer or Konflux admin

---

## Open Enhancements

### ISS-004: Document registry usage for different release stages in skills

- **Discovered:** Phase 2 Plan 3 (2026-01-19) — during PR #903 pipeline failure diagnosis
- **Context:** The PAC_BUILDER in tektoncd-cli Dockerfile was pointing to `registry.redhat.io` (prod) but that image was purged. Investigation revealed the registry flow:
  - `quay.io/openshift-pipeline/` — Dev/CI builds (publicly accessible, use for on-push)
  - `registry.stage.redhat.io/` — Stage releases
  - `registry.redhat.io/` — Production releases
- **Enhancement:** Add registry documentation to relevant skills:
  - `/osp:stage-release` — document registry.stage.redhat.io usage
  - `/osp:prod-release` — document registry.redhat.io usage
  - `/osp:component-builds` or new skill — document quay.io/openshift-pipeline for dev builds
  - Consider creating `/osp:registry-info` skill with registry lookup/verification
- **CLI PAC_BUILDER workflow:** The tkn CLI Dockerfile has a `PAC_BUILDER` ARG that references the PAC CLI image. This must be updated:
  - After prod release expires/before new release: revert to `quay.io/openshift-pipeline/pipelines-pipelines-as-code-cli-rhel8:1.15`
  - During stage release: update to `registry.stage.redhat.io/openshift-pipelines/pipelines-pipelines-as-code-cli-rhel8@sha256:...`
  - During prod release: update to `registry.redhat.io/openshift-pipelines/pipelines-pipelines-as-code-cli-rhel8@sha256:...`
  - Skills should guide this update as part of release workflows
- **Dockerfile version updates on upstream sync:** When syncing upstream (e.g., tektoncd/cli), Dockerfiles need manual updates:
  - `TKN_VERSION` ARG must match the upstream VERSION file
  - Other version-related ARGs may need updating
  - The bot sync PRs don't automatically update Dockerfiles
  - Skills should remind/guide this as part of upstream sync workflow
  - Example: PR #903 synced upstream 0.37.2 but Dockerfile had TKN_VERSION=0.37.1 → needed PR #907 to fix
- **Priority:** Medium — prevents future confusion about which registry to use

## Closed Enhancements

### ISS-003: Create /osp:wait-for-builds skill for Konflux pipeline monitoring

- **Discovered:** Phase 2 Task 1 (2026-01-19) — during Konflux rebuild trigger execution
- **Resolved:** Phase 2 Plan 2 (2026-01-19)
- **Resolution:** Implemented as `/osp:component-builds` skill with three modes:
  - `status`: One-shot pipeline status check for all 11 components
  - `watch`: Poll every 15 minutes until complete (3hr timeout)
  - `freshness`: Verify images are fresh (<72h since last commit)
- Skill file: `commands/osp/component-builds.md`
- Covers all ISS-003 requirements plus freshness checking

### ISS-001: Create /osp:pr-pipeline-status skill to diagnose Konflux pipeline failures

- **Discovered:** Phase 1 Task 2 (2026-01-19)
- **Resolved:** Phase 1 (2026-01-19)
- **Resolution:** Created `commands/osp/pr-pipeline-status.md` skill with:
  - PR check status via `gh pr checks`
  - Konflux pipeline URL parsing
  - SSO authentication flow (prompts user to configure via `/osp:configure`)
  - Common failure pattern diagnosis (base images, EC, build errors)
  - Actionable fix recommendations
- Updated `/osp:configure` to support Konflux SSO cookie storage

### ISS-002: Register release-checklist skill in package.json

- **Discovered:** Phase 1 Task 2 (2026-01-19)
- **Resolved:** Phase 1 (2026-01-19)
- **Resolution:** Not needed - install script auto-discovers all `.md` files in `commands/osp/`. The skill file already exists and will be available after reinstall (`node bin/install.js -g`).
