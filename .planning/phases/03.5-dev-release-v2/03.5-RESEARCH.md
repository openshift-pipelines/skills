# Phase 3.5: Dev Release v2 - Research

**Researched:** 2026-01-22
**Domain:** Dockerfile Labels (CPE/name) and Dev Release Workflow
**Confidence:** HIGH

## Summary

Research confirms that CPE and name labels are already present in most release-v1.15.x Dockerfiles across OpenShift Pipelines components. The standard CPE format is `cpe:/a:redhat:openshift_pipelines:1.15::el8`. A targeted audit identified 5 Dockerfiles missing the CPE label, all within pac-downstream and p12n-manual-approval-gate repositories.

The FIPS fix from Phase 3.4 has been successfully merged (PR #1540, commit ad8982f1) and Konflux on-push pipelines should have triggered rebuilds. The dev release workflow in the operator repo is well-established and can be manually triggered via GitHub Actions.

**Primary recommendation:** Fix the 5 missing CPE labels in pac-downstream and p12n-manual-approval-gate, wait for Konflux rebuilds, then trigger operator-update-images workflow and copy fresh images to dev registry.

## CPE Label Format

### Standard Format
```
cpe="cpe:/a:redhat:openshift_pipelines:1.15::el8"
```

### Required Label Set (from existing Dockerfiles)
```dockerfile
LABEL \
      com.redhat.component="openshift-pipelines-{component}-rhel8-container" \
      name="openshift-pipelines/pipelines-{component}-rhel8" \
      version=$VERSION \
      cpe="cpe:/a:redhat:openshift_pipelines:1.15::el8" \
      summary="Red Hat OpenShift Pipelines {Component}" \
      maintainer="pipelines-extcomm@redhat.com" \
      description="Red Hat OpenShift Pipelines {Component}" \
      io.k8s.display-name="Red Hat OpenShift Pipelines {Component}" \
      io.k8s.description="Red Hat OpenShift Pipelines {Component}" \
      io.openshift.tags="pipelines,tekton,openshift"
```

### Label Requirements (from Konflux/prodsec)
| Label | Required | Example |
|-------|----------|---------|
| `name` | Yes | `openshift-pipelines/pipelines-{component}-rhel8` |
| `cpe` | Yes | `cpe:/a:redhat:openshift_pipelines:1.15::el8` |
| `com.redhat.component` | Yes | `openshift-pipelines-{component}-rhel8-container` |

Source: Verified from existing release-v1.15.x Dockerfiles across all 11 components.

## Dockerfile Audit Results

### Components WITH CPE and name labels (compliant)

| Repository | Dockerfile | Status |
|------------|------------|--------|
| tektoncd-pipeline | controller.Dockerfile | Has CPE + name |
| tektoncd-pipeline | webhook.Dockerfile | Has CPE + name |
| tektoncd-pipeline | resolvers.Dockerfile | Has CPE + name |
| tektoncd-pipeline | entrypoint.Dockerfile | Has CPE + name |
| tektoncd-pipeline | events.Dockerfile | Has CPE + name |
| tektoncd-pipeline | nop.Dockerfile | Has CPE + name |
| tektoncd-pipeline | sidecarlogresults.Dockerfile | Has CPE + name |
| tektoncd-pipeline | workingdirinit.Dockerfile | Has CPE + name |
| tektoncd-triggers | controller.Dockerfile | Has CPE + name |
| tektoncd-triggers | webhook.Dockerfile | Has CPE + name |
| tektoncd-triggers | core-interceptors.Dockerfile | Has CPE + name |
| tektoncd-triggers | eventlistenersink.Dockerfile | Has CPE + name |
| tektoncd-chains | controller.Dockerfile | Has CPE + name |
| tektoncd-results | api.Dockerfile | Has CPE + name |
| tektoncd-results | watcher.Dockerfile | Has CPE + name |
| tektoncd-hub | api.Dockerfile | Has CPE + name |
| tektoncd-hub | db-migration.Dockerfile | Has CPE + name |
| tektoncd-hub | ui.Dockerfile | Has CPE + name |
| tektoncd-cli | tkn.Dockerfile | Has CPE + name |
| tektoncd-git-clone | git-init.Dockerfile | Has CPE + name |
| p12n-console-plugin | console-plugin.Dockerfile | Has CPE + name |
| operator | operator.Dockerfile | Has CPE + name |
| operator | proxy.Dockerfile | Has CPE + name |
| operator | webhook.Dockerfile | Has CPE + name |

### Components MISSING CPE label (need fixes)

| Repository | Dockerfile | Missing Label | Has name | Fix Required |
|------------|------------|---------------|----------|--------------|
| pac-downstream | controller.Dockerfile | cpe | Yes | Add CPE |
| pac-downstream | watcher.Dockerfile | cpe | Yes | Add CPE |
| pac-downstream | cli.Dockerfile | cpe | Yes | Add CPE |
| p12n-manual-approval-gate | controller.Dockerfile | cpe | Yes | Add CPE |
| p12n-manual-approval-gate | webhook.Dockerfile | cpe | Yes | Add CPE |

**Note:** pac-downstream webhook.Dockerfile DOES have the CPE label - only controller, watcher, and cli are missing it.

## FIPS Fix Status

### Commit Details
- **PR:** #1540 (tektoncd-pipeline)
- **Commit SHA:** `ad8982f1db020880b3376c88ea058d4f82b24f12`
- **Message:** "Update nop.Dockerfile for fips"
- **Merged:** 2026-01-22T16:24:26Z
- **Branch:** release-v1.15.x

### Konflux Pipeline
The on-push pipeline triggered automatically when PR #1540 was merged. Konflux will rebuild the tektoncd-pipeline nop image with the FIPS compliance flag.

### Current nop.Dockerfile SHA in project.yaml
```
pipeline-nop-rhel8@sha256:01381d3d77e9eef98b85fbbbae45a0355c0aec5ee86abaa79476e0d20062c4ea
```

This SHA will be updated by Konflux nudge PR or manual workflow trigger once rebuild completes.

## Dev Release Workflow

### Trigger Method
```bash
# Via GitHub Actions UI
# Repository: openshift-pipelines/operator
# Workflow: operator-update-images
# Branch: release-v1.15.x
# Input: environment = "devel"
```

### What the Workflow Does
1. Runs `make ENVIRONMENT=devel update-reference`
2. Script `hack/operator-update-images.sh` reads `project.yaml`
3. Converts Konflux registry (`quay.io/redhat-user-workloads/...`) to dev registry (`quay.io/openshift-pipeline/...`)
4. Updates `.konflux/olm-catalog/bundle/manifests/openshift-pipelines-operator-rh.clusterserviceversion.yaml`
5. Creates PR with updated image references

### Image Registries
| Environment | Registry |
|-------------|----------|
| devel | `quay.io/openshift-pipeline` |
| staging | `registry.stage.redhat.io/openshift-pipelines` |
| production | `registry.redhat.io/openshift-pipelines` |

## Images in Scope (from project.yaml)

Total unique images in project.yaml: 29 (some images are referenced multiple times)

### Unique Component Images
| Component | Image Count | Images |
|-----------|-------------|--------|
| tektoncd-pipeline | 8 | controller, webhook, resolvers, events, entrypoint, workingdirinit, nop, sidecarlogresults |
| tektoncd-triggers | 4 | controller, webhook, core-interceptors, eventlistenersink |
| tektoncd-chains | 1 | controller |
| tektoncd-hub | 3 | api, db-migration, ui |
| tektoncd-results | 2 | api, watcher |
| tektoncd-cli | 1 | tkn |
| pac-downstream | 4 | controller, webhook, watcher, cli |
| p12n-manual-approval-gate | 2 | controller, webhook |
| tektoncd-git-clone | 1 | git-init |
| p12n-console-plugin | 1 | console-plugin |
| operator | 3 | operator, proxy, webhook |
| operator-bundle | 1 | bundle |

### Images Affected by FIPS Fix
Only the nop image (`pipeline-nop-rhel8`) contains the FIPS fix. The rebuild will update only this image's SHA.

## Phase 3 Baseline (from COPY-LOG.md)

In Phase 3.2, 16 images were copied to dev registry:
1. pipelines-chains-controller-rhel8
2. pipelines-console-plugin-rhel8
3. pipelines-entrypoint-rhel8
4. pipelines-hub-api-rhel8
5. pipelines-hub-ui-rhel8
6. pipelines-manual-approval-gate-controller-rhel8
7. pipelines-manual-approval-gate-webhook-rhel8
8. pipelines-operator-proxy-rhel8
9. pipelines-pipelines-as-code-controller-rhel8
10. pipelines-pipelines-as-code-watcher-rhel8
11. pipelines-pipelines-as-code-webhook-rhel8
12. pipelines-results-api-rhel8
13. pipelines-results-watcher-rhel8
14. pipelines-triggers-core-interceptors-rhel8
15. pipelines-triggers-webhook-rhel8
16. pipelines-webhook-rhel8

## Common Pitfalls

### Pitfall 1: Rebuilding All Images Unnecessarily
**What goes wrong:** Thinking all 29 images need to be rebuilt/copied for the FIPS fix
**Why it happens:** Misunderstanding scope of FIPS change
**How to avoid:** Only pipeline-nop-rhel8 needs rebuild. Other images only need label fixes.
**Verification:** After Konflux nudge, only nop SHA should change in project.yaml

### Pitfall 2: Missing Konflux Nudge
**What goes wrong:** Manually triggering operator-update-images before Konflux pushes new SHA
**Why it happens:** Impatience or not understanding Konflux flow
**How to avoid:** Wait for Konflux to create a nudge PR with updated SHA, or check Konflux registry directly
**Verification:** Check if `pipeline-nop-rhel8` has new SHA in Konflux registry

### Pitfall 3: Fixing Labels on Wrong Branch
**What goes wrong:** Fixing labels on main or next instead of release-v1.15.x
**Why it happens:** Default branch confusion
**How to avoid:** Context says "Fix directly on release-v1.15.x branch (not main first)"
**Verification:** All PRs must target release-v1.15.x

## Architecture: Label Fix PRs

### PR 1: pac-downstream (3 Dockerfiles)
- `.konflux/dockerfiles/controller.Dockerfile` - Add CPE
- `.konflux/dockerfiles/watcher.Dockerfile` - Add CPE
- `.konflux/dockerfiles/cli.Dockerfile` - Add CPE

### PR 2: p12n-manual-approval-gate (2 Dockerfiles)
- `.konflux/dockerfiles/controller.Dockerfile` - Add CPE
- `.konflux/dockerfiles/webhook.Dockerfile` - Add CPE

### Label Addition Pattern
Add after existing labels:
```dockerfile
LABEL \
      ...existing labels... \
      cpe="cpe:/a:redhat:openshift_pipelines:1.15::el8"
```

## Open Questions

### Question 1: Konflux nop rebuild completion
- **What we know:** PR merged, on-push pipeline triggered
- **What's unclear:** How long until rebuild completes and nudge PR appears
- **Recommendation:** Check Konflux registry for new SHA, or monitor operator repo for nudge PRs

### Question 2: Bundle rebuild requirement
- **What we know:** Phase 3 noted "Bundle uses pre-Go 1.25 operator images - Fresh bundle build needed for stage"
- **What's unclear:** Is bundle automatically rebuilt when component images change?
- **Recommendation:** After image updates, verify bundle SHA changes or trigger bundle rebuild

## Sources

### Primary (HIGH confidence)
- GitHub API: openshift-pipelines/tektoncd-pipeline release-v1.15.x Dockerfiles
- GitHub API: openshift-pipelines/operator release-v1.15.x project.yaml
- GitHub API: All component repos (triggers, chains, results, hub, cli, pac-downstream, git-clone, console-plugin, manual-approval-gate)
- Local files: .planning/phases/03.4-cherry-pick-fips/03.4-VERIFICATION.md
- Local files: .planning/phases/03.2-fix-missing-dev-images/COPY-LOG.md

### Secondary (MEDIUM confidence)
- Phase context: CONTEXT.md decisions about CPE/name label fixes
- Slack conversation context: Ralph Bean's confirmation about enforceContainerFirstSecurityLabels

## Metadata

**Confidence breakdown:**
- CPE label format: HIGH - Verified from 24+ existing Dockerfiles
- Missing labels audit: HIGH - Checked all 11 component repos
- FIPS fix status: HIGH - Verified PR merged, commit on branch
- Dev release workflow: HIGH - Verified workflow file and scripts

**Research date:** 2026-01-22
**Valid until:** 2026-02-22 (30 days - stable domain)
