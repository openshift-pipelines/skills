---
phase: 03.4-cherry-pick-fips
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "PR exists targeting release-v1.15.x with FIPS nop.Dockerfile fix"
    - "Cherry-picked commit SHA matches original (2bb10e0fa71a3c91f79472eb6315ebf142ca57cc)"
    - "PR is merged and Konflux on-push pipeline triggered"
  artifacts:
    - path: ".planning/phases/03.4-cherry-pick-fips/03.4-01-SUMMARY.md"
      provides: "Record of cherry-pick PR URL and merge status"
  key_links:
    - from: "openshift-pipelines/tektoncd-pipeline release-v1.20.x"
      to: "openshift-pipelines/tektoncd-pipeline release-v1.15.x"
      via: "git cherry-pick"
      pattern: "2bb10e0fa71a3c91f79472eb6315ebf142ca57cc"
---

<objective>
Cherry-pick the FIPS nop.Dockerfile fix from release-v1.20.x to release-v1.15.x in openshift-pipelines/tektoncd-pipeline.

Purpose: Include the FIPS compliance fix in the 1.15.4 release. This fix updates nop.Dockerfile for FIPS requirements and must be backported before stage release.

Output: Merged PR on release-v1.15.x with the FIPS fix, triggering Konflux rebuild of tektoncd-pipeline component.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.4-cherry-pick-fips/.continue-here.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clone repo, create branch, and cherry-pick FIPS fix</name>
  <files>/tmp/tektoncd-pipeline (temporary clone)</files>
  <action>
Clone openshift-pipelines/tektoncd-pipeline, create a branch from release-v1.15.x, and cherry-pick the FIPS fix commit.

**Commands:**
```bash
# Clone the repo (fresh clone to /tmp to avoid polluting workspace)
git clone git@github.com:openshift-pipelines/tektoncd-pipeline.git /tmp/tektoncd-pipeline
cd /tmp/tektoncd-pipeline

# Fetch both branches
git fetch origin release-v1.15.x release-v1.20.x

# Create branch from release-v1.15.x
git checkout -b cherry-pick-fips-1.15 origin/release-v1.15.x

# Cherry-pick the FIPS fix commit
git cherry-pick 2bb10e0fa71a3c91f79472eb6315ebf142ca57cc
```

**Cherry-pick details:**
- Commit: `2bb10e0fa71a3c91f79472eb6315ebf142ca57cc`
- Message: "Update nop.Dockerfile for fips"
- Source: release-v1.20.x (commit is HEAD on this branch)
- Target: release-v1.15.x

**Conflict handling:**
If cherry-pick has conflicts:
1. Check what files conflict (likely just nop.Dockerfile)
2. Review the changes in the original commit: `git show 2bb10e0fa71a3c91f79472eb6315ebf142ca57cc`
3. Resolve manually, keeping the FIPS-related changes
4. `git add` resolved files and `git cherry-pick --continue`

**Expected outcome:**
New commit on cherry-pick-fips-1.15 branch with FIPS nop.Dockerfile changes.
  </action>
  <verify>git log -1 --oneline shows cherry-picked commit with "Update nop.Dockerfile for fips" or similar message</verify>
  <done>FIPS fix commit cherry-picked to branch cherry-pick-fips-1.15</done>
</task>

<task type="auto">
  <name>Task 2: Push branch and create PR</name>
  <files>/tmp/tektoncd-pipeline (temporary clone)</files>
  <action>
Push the cherry-pick branch and create a PR targeting release-v1.15.x.

**Commands:**
```bash
cd /tmp/tektoncd-pipeline

# Push branch to origin
git push origin cherry-pick-fips-1.15

# Create PR using gh CLI
gh pr create \
  --repo openshift-pipelines/tektoncd-pipeline \
  --base release-v1.15.x \
  --head cherry-pick-fips-1.15 \
  --title "Cherry-pick: Update nop.Dockerfile for fips (1.15.x backport)" \
  --body "$(cat <<'EOF'
## Summary

Cherry-pick of commit 2bb10e0fa71a3c91f79472eb6315ebf142ca57cc from release-v1.20.x to release-v1.15.x.

Original commit: "Update nop.Dockerfile for fips"

This FIPS compliance fix is required for the 1.15.4 patch release.

## Test plan

- [ ] Konflux on-push pipeline passes
- [ ] No build regressions

## References

- Source commit: https://github.com/openshift-pipelines/tektoncd-pipeline/commit/2bb10e0fa71a3c91f79472eb6315ebf142ca57cc
- Target release: 1.15.4
EOF
)"
```

**Record PR URL** for checkpoint verification.
  </action>
  <verify>gh pr view shows PR created targeting release-v1.15.x with correct title</verify>
  <done>PR created and URL recorded</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>PR for cherry-picking FIPS fix to release-v1.15.x</what-built>
  <how-to-verify>
1. Open the PR URL from Task 2
2. Verify:
   - PR targets `release-v1.15.x` branch
   - Contains only the nop.Dockerfile FIPS changes
   - Konflux pipelines are triggered (check PR checks)
3. Request review/approval from maintainers if needed
4. Wait for PR to be merged

**PR will need:**
- At least one approving review
- Passing CI checks (Konflux pipeline)

**After merge:**
- Konflux on-push pipeline will trigger automatically
- New tektoncd-pipeline image will be built
- Image will be available for stage release
  </how-to-verify>
  <resume-signal>Type "pr-merged" with the PR number when the PR is merged, or "blocked" if there are issues preventing merge</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Verify merge and update project state</name>
  <files>.planning/STATE.md, .planning/ROADMAP.md</files>
  <action>
After checkpoint confirms PR merged:

1. Verify merge using gh CLI:
```bash
gh pr view {PR_NUMBER} --repo openshift-pipelines/tektoncd-pipeline --json state,mergedAt
```

2. Check Konflux on-push pipeline triggered:
```bash
# Use component-builds skill pattern
gh api repos/redhat-appstudio/build-definitions/actions/runs \
  --jq '.workflow_runs[] | select(.head_branch=="release-v1.15.x") | {id, status, conclusion, created_at}'
```

3. Update STATE.md:
- Move current position to Phase 3.4 complete
- Update "Current focus" to Phase 4 (Stage Release) - still blocked on CVE-2025-59375
- Update session continuity

4. Update ROADMAP.md:
- Mark Phase 3.4 checkbox as complete: `- [x] 03.4-01: Cherry-pick commit and create PR`
- Update status to complete with date

5. Commit planning docs:
```bash
git add .planning/STATE.md .planning/ROADMAP.md
git commit -m "docs(03.4): complete FIPS cherry-pick phase

- PR merged to release-v1.15.x
- Konflux rebuild triggered
- Ready for stage release (pending CVE-2025-59375)"
```
  </action>
  <verify>STATE.md shows Phase 3.4 complete, ROADMAP.md checkbox marked</verify>
  <done>Phase 3.4 documented as complete, project state updated</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. PR merged to release-v1.15.x branch
2. Konflux on-push pipeline triggered for tektoncd-pipeline component
3. Project tracking updated (STATE.md, ROADMAP.md)
4. Ready to proceed with Phase 4 (blocked only on CVE-2025-59375)
</verification>

<success_criteria>
- FIPS fix cherry-picked from release-v1.20.x to release-v1.15.x
- PR created, reviewed, and merged
- Konflux rebuild triggered automatically
- Phase 3.4 documented as complete in project tracking
- Only remaining blocker for stage release is CVE-2025-59375
</success_criteria>

<output>
After completion, create `.planning/phases/03.4-cherry-pick-fips/03.4-01-SUMMARY.md`
</output>
