---
phase: 02-fix-blockers
plan: 03
type: execute
---

<objective>
Verify all 11 Konflux images are built successfully before proceeding to dev release.

Purpose: Before executing the dev release (Phase 3), we need confirmation that all component images exist and are fresh (<72h) in the Konflux registry.
Output: Verification report showing all 11 components have fresh images ready for release.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-assessment/KONFLUX-FRESHNESS-REPORT.md
@.planning/phases/02-fix-blockers/02-01-SUMMARY.md
@.planning/phases/02-fix-blockers/02-02-SUMMARY.md

**From Phase 2 Plan 1:**
- 8 stale components should have been re-triggered
- Pipelines run automatically on push (on-push pipelines)
- Typical pipeline runtime: 15-30 minutes

**From Phase 2 Plan 2:**
- PR #903 fix should be in progress or complete
- tektoncd-cli image may have additional rebuild from PR merge

**All 11 Components to Verify:**
| # | Component | Expected Source |
|---|-----------|-----------------|
| 1 | tektoncd-pipeline | 02-01 rebuild |
| 2 | tektoncd-triggers | 02-01 rebuild |
| 3 | tektoncd-chains | 02-01 rebuild |
| 4 | tektoncd-results | 02-01 rebuild |
| 5 | tektoncd-hub | 02-01 rebuild |
| 6 | tektoncd-cli | 02-01 rebuild + PR #903 merge |
| 7 | pac-downstream | 02-01 rebuild |
| 8 | tektoncd-git-clone | 02-01 rebuild |
| 9 | console-plugin | Already fresh (01-02) |
| 10 | manual-approval-gate | Already fresh (01-02) |
| 11 | operator | Already fresh (01-02) |

**Konflux Registry:**
- Base URL: `quay.io/redhat-user-workloads/tekton-ecosystem-tenant/`
- Images are tagged by component name
</context>

<tasks>

<task type="auto">
  <name>Task 1: Check pipeline status for all 8 re-triggered components</name>
  <files>None (API calls only)</files>
  <action>
For each of the 8 components re-triggered in 02-01, check the latest pipeline run status:

```bash
# Components to check
COMPONENTS="tektoncd-pipeline tektoncd-triggers tektoncd-chains tektoncd-results tektoncd-hub tektoncd-cli pac-downstream tektoncd-git-clone"

for REPO in $COMPONENTS; do
  echo "=== $REPO ==="

  # Get latest commit on release-v1.15.x
  LATEST_COMMIT=$(gh api repos/openshift-pipelines/${REPO}/commits/release-v1.15.x --jq '.sha' | head -c7)
  COMMIT_DATE=$(gh api repos/openshift-pipelines/${REPO}/commits/release-v1.15.x --jq '.commit.committer.date')

  echo "Latest commit: $LATEST_COMMIT ($COMMIT_DATE)"

  # Get check runs for that commit
  gh api "repos/openshift-pipelines/${REPO}/commits/release-v1.15.x/check-runs" \
    --jq '.check_runs[] | select(.name | contains("on-push")) | {name: .name, status: .status, conclusion: .conclusion}' 2>/dev/null || echo "No check runs found"

  echo ""
done
```

**Expected outcomes:**
- status: "completed", conclusion: "success" → Pipeline passed
- status: "in_progress" → Still running, need to wait
- status: "completed", conclusion: "failure" → Pipeline failed, needs investigation

Record which components are:
- Passed
- In Progress
- Failed
  </action>
  <verify>Script runs without error and shows status for all 8 components</verify>
  <done>Pipeline status retrieved for all 8 re-triggered components</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Pipeline status check for all re-triggered components</what-built>
  <how-to-verify>
Review the pipeline status output from Task 1:

1. **All Passed?** If all 8 show conclusion: "success", proceed with "approved"

2. **Some In Progress?** If pipelines are still running:
   - Wait 15-30 minutes for completion
   - Re-run the check script
   - Report status once all complete

3. **Any Failed?** If any pipeline failed:
   - Note which component(s) failed
   - Describe the failure (or run `/osp:pr-pipeline-status owner/repo BRANCH`)
   - We may need to create another fix plan

**Also verify PR #903 status:**
```bash
gh pr view 903 --repo openshift-pipelines/tektoncd-cli --json state,mergeable,mergeStateStatus
```
- If merged: Great, oauth2 CVE resolved
- If open + mergeable + checks pass: Ready to merge
- If open + failing: Document issue
  </how-to-verify>
  <resume-signal>
Type one of:
- "approved" - All 8 pipelines passed, PR #903 merged or ready
- "in-progress: X still running" - List which components still building
- "failed: X failed because Y" - List failures and errors
  </resume-signal>
</task>

<task type="auto">
  <name>Task 3: Verify images exist in Konflux registry</name>
  <files>None (registry inspection)</files>
  <action>
Verify all 11 component images exist and are fresh in the Konflux registry:

```bash
# All 11 components
COMPONENTS=(
  "tektoncd-pipeline"
  "tektoncd-triggers"
  "tektoncd-chains"
  "tektoncd-results"
  "tektoncd-hub"
  "tektoncd-cli"
  "pac-downstream"
  "tektoncd-git-clone"
  "console-plugin"
  "manual-approval-gate"
  "operator"
)

REGISTRY="quay.io/redhat-user-workloads/tekton-ecosystem-tenant"

echo "| Component | Image Exists | Last Updated | Status |"
echo "|-----------|--------------|--------------|--------|"

for COMPONENT in "${COMPONENTS[@]}"; do
  # Check if image exists (this checks the manifest)
  if skopeo inspect "docker://${REGISTRY}/${COMPONENT}:latest" --no-tags >/dev/null 2>&1; then
    # Get created date
    CREATED=$(skopeo inspect "docker://${REGISTRY}/${COMPONENT}:latest" --no-tags 2>/dev/null | jq -r '.Created // .created // "unknown"')
    echo "| $COMPONENT | Yes | $CREATED | OK |"
  else
    echo "| $COMPONENT | NO | - | MISSING |"
  fi
done
```

**Alternative check via GitHub commit dates (if skopeo unavailable):**
```bash
for COMPONENT in "${COMPONENTS[@]}"; do
  BRANCH="release-v1.15.x"
  [[ "$COMPONENT" == "manual-approval-gate" ]] && BRANCH="release-v0.2.2"

  COMMIT_DATE=$(gh api "repos/openshift-pipelines/${COMPONENT}/commits/${BRANCH}" --jq '.commit.committer.date' 2>/dev/null)
  AGE_HOURS=$(( ($(date +%s) - $(date -d "$COMMIT_DATE" +%s)) / 3600 ))

  if [[ $AGE_HOURS -lt 72 ]]; then
    STATUS="FRESH"
  else
    STATUS="STALE"
  fi

  echo "| $COMPONENT | $BRANCH | $COMMIT_DATE | ${AGE_HOURS}h | $STATUS |"
done
```

All components should show:
- Image exists: Yes
- Age: < 72 hours
- Status: OK/FRESH
  </action>
  <verify>All 11 components show fresh images in the table</verify>
  <done>All 11 component images verified as fresh and available</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 8 re-triggered pipelines completed successfully
- [ ] PR #903 merged (or documented why not)
- [ ] All 11 component images verified fresh (<72h)
- [ ] No blocking issues remain for dev release
</verification>

<success_criteria>

- All 11 components have fresh images (<72h old)
- All Konflux on-push pipelines passed
- PR #903 oauth2 fix merged (or clear path to merge)
- Phase 2 blockers resolved
- Ready to proceed to Phase 3: Dev Release
</success_criteria>

<output>
After completion, create `.planning/phases/02-fix-blockers/02-03-SUMMARY.md`:

# Phase 2 Plan 3: Verify All Images Summary

**[One-liner: e.g., "All 11 components verified fresh, ready for dev release"]**

## Pipeline Results

| Component | Pipeline Status | Conclusion |
|-----------|-----------------|------------|
| tektoncd-pipeline | completed | success |
| ... | ... | ... |

## Image Freshness

| Component | Last Updated | Age | Status |
|-----------|--------------|-----|--------|
| tektoncd-pipeline | 2026-01-19T... | 2h | FRESH |
| ... | ... | ... | ... |

## PR #903 Status

- State: [merged / open]
- If open: [mergeable, checks status]

## Blockers Resolved

- [x] 8 stale components rebuilt
- [x] PR #903 pipeline fixed and merged
- [x] All images fresh

## Next Step

Phase 2: Fix Blockers COMPLETE

Ready for Phase 3: Dev Release
Run: `/gsd:plan-phase 3`
</output>
