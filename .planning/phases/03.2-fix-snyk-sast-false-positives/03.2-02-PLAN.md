---
phase: 03.2-fix-snyk-sast-false-positives
plan: 02
type: execute
wave: 2
depends_on: ["03.2-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All Snyk SAST false positives are suppressed"
    - "EC check passes on operator/proxy/webhook PRs"
    - "Suppressions include clear justification comments"
    - "ISS-006 is closed in ISSUES.md"
  artifacts:
    - path: "PR in github.com/openshift/tektoncd-operator"
      provides: "Code changes with #nosec annotations or alternative fix"
    - path: ".planning/ISSUES.md"
      provides: "ISS-006 marked as closed"
  key_links:
    - from: "PR with fix"
      to: "Konflux sast-snyk-check task"
      via: "Pipeline triggers on PR"
      pattern: "sast-snyk-check.*passed"
    - from: "Konflux sast-snyk-check"
      to: "Enterprise Contract"
      via: "EC evaluates Snyk results"
      pattern: "ec-check.*passed"
---

<objective>
Implement the Snyk SAST false positive fix based on Plan 01's findings and verify EC passes.

Purpose: Unblock Stage Release (Phase 4) by fixing ISS-006 - EC failures on operator/proxy/webhook PRs.

Output: Merged PR with suppressions, passing EC checks, ISS-006 closed.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/ISSUES.md
@.planning/phases/03.2-fix-snyk-sast-false-positives/03.2-RESEARCH.md
@.planning/phases/03.2-fix-snyk-sast-false-positives/03.2-01-SUMMARY.md
@.planning/phases/03.2-fix-snyk-sast-false-positives/SNYK-FINDINGS.md
@.planning/phases/03.2-fix-snyk-sast-false-positives/APPROACH-DECISION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement suppressions in operator code</name>
  <files>Files identified in SNYK-FINDINGS.md</files>
  <action>
Based on APPROACH-DECISION.md from Plan 01, implement the fix:

**If #nosec approach works:**
1. Clone/update github.com/openshift/tektoncd-operator
2. Create branch: `fix-snyk-sast-false-positives`
3. For each finding in SNYK-FINDINGS.md, add inline suppression:
   ```go
   const TektonResultsPostgresSecret = "tekton-results-postgres" // #nosec G101 -- Kubernetes Secret resource name, not credential value
   ```
4. Use consistent justification format: `// #nosec G101 -- {reason}`
5. Group similar findings with same justification pattern:
   - Secret resource names: "Kubernetes Secret resource name, not credential value"
   - Env var keys: "Environment variable key name, not credential value"
   - Database names: "Database connection parameter name, not credential"
6. Create PR with title: "fix(security): suppress Snyk SAST false positives for Secret resource names"
7. PR description should explain:
   - What was flagged (Secret names/env var keys)
   - Why these are false positives (not actual credentials)
   - Link to ISS-006 or relevant issue

**If IGNORE_FILE_PATHS fallback needed:**
1. Identify the minimum set of files to exclude
2. Update `.tekton/operator-on-pull-request.yaml` with IGNORE_FILE_PATHS parameter
3. Document this as temporary workaround
4. Create follow-up issue to fix properly with #nosec when Snyk supports it

**PR hygiene:**
- Add `lgtm` and `approved` labels if you have permission, or request review
- Include `/cc @{maintainer}` if known
- Reference ISS-006 in PR description
  </action>
  <verify>PR created with all necessary suppression comments, pipeline triggered</verify>
  <done>All false positives have suppression comments, PR is open and building</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>PR with Snyk SAST false positive suppressions</what-built>
  <how-to-verify>
1. Go to the PR URL (will be provided by Task 1)
2. Check Konflux pipeline status - look for sast-snyk-check task
3. Verify sast-snyk-check passes OR shows reduced findings count
4. Check EC (Enterprise Contract) status
5. If EC passes: Approve/merge the PR
6. If EC still fails: Report which findings remain

Expected outcome:
- sast-snyk-check: Passed (or reduced from 15-16 to 0 findings)
- ec-check: Passed
  </how-to-verify>
  <resume-signal>Type "ec-passed" if EC passes, or describe remaining failures</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Close ISS-006 and update project state</name>
  <files>.planning/ISSUES.md, .planning/STATE.md</files>
  <action>
After EC passes (confirmed by checkpoint):

1. Update .planning/ISSUES.md:
   - Move ISS-006 to "Closed Enhancements" section
   - Add resolution details:
     ```markdown
     ### ISS-006: Snyk SAST false positives causing EC failures on operator/proxy/webhook

     - **Discovered:** Phase 3 Plan 2 (2026-01-20)
     - **Resolved:** Phase 3.2 (2026-01-21)
     - **Resolution:** Added #nosec G101 inline comments to suppress false positives for Kubernetes Secret resource names and environment variable key names. PR #{number} merged. EC now passes.
     ```

2. Update .planning/STATE.md:
   - Remove ISS-006 from blockers
   - Update "Current focus" to indicate Phase 4 ready
   - Update progress indicator

3. Commit changes:
   ```bash
   git add .planning/ISSUES.md .planning/STATE.md
   git commit -m "docs: close ISS-006 - Snyk SAST false positives resolved"
   ```
  </action>
  <verify>ISS-006 shows as "Closed" in ISSUES.md, STATE.md shows Phase 4 unblocked</verify>
  <done>ISS-006 closed, Phase 4 (Stage Release) is now unblocked</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. PR with suppressions is merged (or approved and ready to merge)
2. EC check passes on operator/proxy/webhook PRs
3. ISS-006 is documented as closed in ISSUES.md
4. STATE.md reflects that Phase 4 is unblocked
</verification>

<success_criteria>
- All Snyk SAST false positives suppressed with documented justifications
- EC check passes (verified by human in checkpoint)
- ISS-006 closed in project tracking
- Phase 4 (Stage Release) is unblocked and ready to execute
</success_criteria>

<output>
After completion, create `.planning/phases/03.2-fix-snyk-sast-false-positives/03.2-02-SUMMARY.md`
</output>
