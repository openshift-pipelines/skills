---
phase: 03-dev-release
task: fixing-catalog-template
total_tasks: 5
status: in_progress
last_updated: 2026-01-20T09:50:00Z
---

<current_state>
Fixing catalog-template.json duplicate bundle issue for v1.15.4 release.

**Error encountered:** `duplicate bundle "openshift-pipelines-operator-rh.v1.15.4"`

Root cause: Both v1.15.3 and v1.15.4 entries in catalog-template.json pointed to the SAME bundle image (sha256:e9eb98ac...). When `opm render-template` runs, it pulls the image and extracts metadata - since both pointed to the v1.15.4 image, both rendered as v1.15.4.

**Fix in progress:** Restore v1.15.3 image to original (sha256:0ba1efe8...).
</current_state>

<completed_work>
- Diagnosed original error: `bundle v1.15.4 not found in any channel entries`
- Root cause: BUNDLE_NAME in script was v1.15.3, v1.15.4 missing from catalog-template.json
- Created PR #14338: Added v1.15.4 to catalog-template.json for all OCP versions
- PR #14338 merged
- Closed old failing catalog PRs (#14327, #14328, #14326, #14329, #14324)
- Re-ran index-render-template workflow
- New catalog PRs created: #14339 (v4.18), #14340 (v4.17), #14341 (v4.12), #14342 (v4.16), #14343 (v4.14), #14344 (v4.15)
- Closed #14341 (v4.12) - EOL
- Diagnosed duplicate bundle error
- Cloned repo to /tmp/operator-fix2
- Fixed v1.15.3 image in catalog-template.json for v4.14, v4.15, v4.16, v4.17, v4.18
- Created branch: fix/restore-v1.15.3-image
- Committed fix locally
</completed_work>

<remaining_work>
- Push branch fix/restore-v1.15.3-image
- Create PR targeting release-v1.15.x
- Merge PR
- Close current failing catalog PRs (#14339, #14340, #14342, #14343, #14344)
- Re-run index-render-template workflow (3rd time)
- Wait for new catalog PRs to pass Konflux pipelines
- Merge catalog PRs
- Resume dev release testing (Plan 03-02)
</remaining_work>

<decisions_made>
- Skip OCP 4.12 - it's EOL
- Root cause of original error: index-render-template workflow only UPDATES existing bundle images, doesn't ADD new versions. For v1.15.3, a manual PR (#4816) added the version. This was missed for v1.15.4.
- Root cause of duplicate error: When we added v1.15.4, the v1.15.3 entry already had its image updated to the new v1.15.4 bundle image by a previous workflow run. Both entries pointed to same image, causing opm to render duplicates.
</decisions_made>

<blockers>
**Current:** Catalog PRs failing with duplicate bundle error
**Fix ready:** Branch fix/restore-v1.15.3-image created but not pushed
</blockers>

<context>
The index-render-template.sh script has BUNDLE_NAME hardcoded - it only updates the image SHA for that bundle. It does NOT add new versions to the catalog.

For patch releases, the proper workflow is:
1. Manually add new version to catalog-template.json (channel entry + olm.bundle)
2. Update BUNDLE_NAME in hack/index-render-template.sh
3. Run index-render-template workflow

The v1.15.3 entry must point to the OLD v1.15.3 bundle image:
  sha256:0ba1efe8f9fce499ec4259ea39eef5e0f0536185e84c1e84b766ae3efa2d9b37

The v1.15.4 entry points to the NEW v1.15.4 bundle image:
  sha256:e9eb98ac08453a63c534fe6f6ba75bc6989e9d171770aab6e971d1c4617c7535

Repo clone with fix is at: /tmp/operator-fix2
Branch: fix/restore-v1.15.3-image (committed but not pushed)
</context>

<next_action>
1. Push the fix branch:
   ```bash
   cd /tmp/operator-fix2 && git push origin fix/restore-v1.15.3-image
   ```

2. Create PR:
   ```bash
   gh pr create --repo openshift-pipelines/operator --base release-v1.15.x --head fix/restore-v1.15.3-image --title "fix(1.15.4): Restore v1.15.3 bundle image to original" --body "..."
   ```

3. Merge PR, close failing catalog PRs, re-run workflow
</next_action>
